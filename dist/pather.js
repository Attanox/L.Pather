!function(){"use strict";function t(t){throw"L.Pather: "+t+"."}"undefined"==typeof L&&t("Leaflet.js is required: http://leafletjs.com/");var n={VIEW:1,CREATE:2,EDIT:4,DELETE:8,APPEND:16,EDIT_APPEND:20,ALL:31};L.Pather=L.FeatureGroup.extend({initialize:function(t){this.options=Object.assign(this.defaultOptions(),t||{}),this.creating=!1,this.polylines=[]},createPath:function(t){if(t.length<=1)return!1;this.clearAll();var n=new L.Pather.Polyline(this.map,t,this.options,this.fire.bind(this));return this.polylines.push(n),n},removePath:function(t){if(t instanceof L.Pather.Polyline){var n=this.polylines.indexOf(t);return this.polylines.splice(n,1),t.remove()}return!1},onAdd:function(t){t.dragging.disable();var n=this.options.element||t._container;this.map=t,this.fromPoint={x:0,y:0},this.svg=d3.select(n).append("svg").attr("pointer-events","none").attr("class",this.getOption("moduleClass")).attr("width",this.getOption("width")).attr("height",this.getOption("height")),this.attachEvents(t)},attachEvents:function(t){function i(){return o.filter(function(t){return t.manipulating})}function e(){return!!(s&n.CREATE)}var o=this.polylines,s=this.options.mode;t.on("mousedown",function(n){e()&&0===i().length&&(this.creating=!0,this.fromPoint=t.latLngToContainerPoint(n.latlng),this.latLngs=[])}.bind(this)),t.on("mouseup",function(){return 0===i().length?(this.creating=!1,this.createPath(this.convertPointsToLatLngs(this.latLngs)),void(this.latLngs=[])):(i()[0].attachElbows(),i()[0].finished(),void(i()[0].manipulating=!1))}.bind(this)),t.on("mousemove",function(n){if(i().length>0)return void i()[0].moveTo(n.layerPoint);var e=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear");if(this.creating){var o=t.mouseEventToContainerPoint(n.originalEvent),s=[this.fromPoint,new L.Point(o.x,o.y,!1)];this.latLngs.push(o),this.svg.append("path").classed(this.getOption("lineClass"),!0).attr("d",e(s)).attr("stroke",this.getOption("strokeColour")).attr("stroke-width",this.getOption("strokeWidth")).attr("fill","none"),this.fromPoint={x:o.x,y:o.y}}}.bind(this))},convertPointsToLatLngs:function(t){return t.map(function(t){return this.map.containerPointToLatLng(t)}.bind(this))},clearAll:function(){this.svg.text("")},getOption:function(t){return this.options[t]||this.defaultOptions()[t]},defaultOptions:function(){return{moduleClass:"pather",lineClass:"drawing-line",elbowClass:"elbow",strokeColour:"rgba(0,0,0,.5)",strokeWidth:2,width:"100%",height:"100%",smoothFactor:10,pathColour:"black",pathOpacity:.55,pathWidth:3,mode:n.ALL}},setSmoothFactor:function(t){this.options.smoothFactor=parseInt(t),this.polylines.forEach(function(n){n.setSmoothFactor(t)})}}),L.Pather.MODE=n,L.pather=function(t){return new L.Pather(t)}}(),function(){"use strict";Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,n){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var i=Object(t),e=1;e<arguments.length;e++){var o=arguments[e];if(void 0!==o&&null!==o){o=Object(o);for(var s=Object.keys(Object(o)),a=0,r=s.length;r>a;a++){var h=s[a],l=Object.getOwnPropertyDescriptor(o,h);void 0!==l&&l.enumerable&&(i[h]=o[h])}}}return i}})}(),function(){"use strict";var t="_pather";L.Pather.Polyline=function(t,n,i,e){this.options={color:i.pathColour,opacity:i.pathOpacity,weight:i.pathWidth,smoothFactor:i.smoothFactor||1,elbowClass:i.elbowClass},this.polyline=new L.Polyline(n,this.options).addTo(t),this.map=t,this.fire=e||function(){},this.edges=[],this.manipulating=!1,this.attachPolylineEvents(this.polyline),this.select(),this.fire("created",{polyline:this,latLngs:this.getLatLngs()})},L.Pather.Polyline.prototype={select:function(){this.attachElbows()},deselect:function(){this.manipulating=!1},attachElbows:function(){this.detachElbows(),this.polyline._parts[0].forEach(function(n){var i=new L.DivIcon({className:this.options.elbowClass}),e=this.map.layerPointToLatLng(n),o=new L.Marker(e,{icon:i}).addTo(this.map);o[t]={point:n},this.attachElbowEvents(o),this.edges.push(o)}.bind(this))},detachElbows:function(){this.edges.forEach(function(t){this.map.removeLayer(t)}.bind(this)),this.edges.length=0},attachPolylineEvents:function(t){t.on("click",function(t){t.originalEvent.stopPropagation(),t.originalEvent.preventDefault()}.bind(this))},attachElbowEvents:function(t){t.on("mousedown",function(n){n.originalEvent.stopPropagation(),n.originalEvent.preventDefault(),this.manipulating=t}.bind(this)),t.on("mouseup",function(t){t.originalEvent.stopPropagation(),t.originalEvent.preventDefault(),this.manipulating=!1})},insertElbow:function(t){var n=this.map.latLngToContainerPoint(t),i=1/0,e=-1;this.polyline._latlngs.forEach(function(t,o){if(this.polyline._latlngs[o]){var s=this.map.latLngToContainerPoint(t),a=this.map.latLngToContainerPoint(this.polyline._latlngs[o]),r=L.LineUtil.pointToSegmentDistance(n,s,a);i>r&&(i=r,e=o)}}.bind(this));var o=this.polyline.getLatLngs();o.splice(e,0,t),this.polyline.setLatLngs(o),this.redraw(this.latLngsToEdges(o)),this.attachElbows()},moveTo:function(t){var n=this.map.layerPointToLatLng(t);this.manipulating.setLatLng(n),this.redraw(this.edges)},finished:function(){this.fire("edited",{polyline:this,latLngs:this.getLatLngs()})},redraw:function(t){var n=[];t.forEach(function(t){n.push(t._latlng)}),this.remove(!1),this.polyline=new L.Polyline(n,this.options).addTo(this.map),this.attachPolylineEvents(this.polyline)},remove:function(t){t="undefined"==typeof t?!0:t,this.map.removeLayer(this.polyline),t&&this.edges.forEach(function(t){this.map.removeLayer(t)}.bind(this))},latLngsToEdges:function(t){return t.map(function(t){return{_latlng:t}})},getLatLngs:function(){return this.polyline._latlngs},setSmoothFactor:function(t){this.options.smoothFactor=parseInt(t),this.remove(),this.redraw(this.latLngsToEdges(this.polyline._latlngs)),this.attachElbows()}}}();